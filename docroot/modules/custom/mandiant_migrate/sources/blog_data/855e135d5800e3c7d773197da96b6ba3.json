{
  "jcr:primaryType": "cq:Page",
  "jcr:createdBy": "admin",
  "jcr:created": "Tue Apr 13 2021 15:00:05 GMT+0000",
  "jcr:content": {
    "jcr:primaryType": "cq:PageContent",
    "jcr:mixinTypes": [
      "mix:versionable"
    ],
    "jcr:createdBy": "admin",
    "jcr:title": "Hacking Operational Technology for Defense: Lessons Learned From OT Red Teaming Smart Meter Control Infrastructure",
    "jcr:versionHistory": "791d9dd4-c7a2-4325-acc4-4aee1181e9a0",
    "author": "Shishir Gupta",
    "cq:template": "\/apps\/fireeye-blog\/templates\/page_blogpost",
    "jcr:language": "en_us",
    "jcr:predecessors": [
      "99383c73-781f-4da8-a55c-e265cea00ac9"
    ],
    "jcr:created": "Tue Apr 13 2021 15:51:19 GMT+0000",
    "cq:lastModified": "Tue Apr 13 2021 15:50:36 GMT+0000",
    "jcr:baseVersion": "99383c73-781f-4da8-a55c-e265cea00ac9",
    "jcr:isCheckedOut": true,
    "cq:tags": [
      "fireeye-blog-authors:shishir-gupta",
      "fireeye-blog-authors:daniel-kapellmann-zafra",
      "fireeye-blog-authors:ken-proska",
      "fireeye-blog-authors:nathan-brubaker",
      "fireeye-blog-threat-research:threat-research",
      "fireeye-blog-tags:homepage-carousel",
      "fireeye-blog-tags:ics-security",
      "fireeye-blog-tags:latest",
      "fireeye-blog-tags:operational-technology",
      "fireeye-blog-tags:threat-intelligence"
    ],
    "jcr:uuid": "97593fdc-158e-48e7-b9eb-393d7e858063",
    "sling:resourceType": "social\/blog\/components\/page",
    "published": "Tue Apr 13 2021 11:00:00 GMT-0400",
    "cq:lastModifiedBy": "adam.greenberg@fireeye.com",
    "par": {
      "jcr:primaryType": "nt:unstructured",
      "sling:resourceType": "foundation\/components\/parsys",
      "entry": {
        "jcr:primaryType": "nt:unstructured",
        "jcr:lastModifiedBy": "adam.greenberg@fireeye.com",
        "text": "\u003Cp\u003EHigh-profile security incidents in the past decade have brought increased scrutiny to cyber security for operational technology (OT). However, there is a continued perception across critical infrastructure organizations that OT networks are isolated from public networks\u2014such as the Internet. In Mandiant\u2019s experience, the concept of an \u2018air gap\u2019 separating OT assets from external networks rarely holds true in practice.\u003C\/p\u003E\n\u003Cp\u003EIn 2018, we released a blog post presenting the tools and techniques that \u003Ca adhocenable=\u0022false\u0022 href=\u0022\/content\/fireeye-www\/en_US\/blog\/threat-research\/2019\/04\/triton-actor-ttp-profile-custom-attack-tools-detections.html\u0022\u003ETEMP.Veles used during the TRITON incident\u003C\/a\u003E to traverse from an external compromise of the information technology (IT) network of a critical infrastructure organization to the safety systems located deep in the OT network. We regularly reproduce this approach in our OT-focused red team engagements to expose similar attack paths across client infrastructure and to identify environment specific opportunities to prevent and detect network propagation techniques across intermediary systems.\u003C\/p\u003E\n\u003Cp\u003EIn this blog post, we share another case study from one of our \u003Ca href=\u0022\/content\/fireeye-www\/en_US\/blog\/threat-research\/2020\/08\/hands-on-introduction-to-mandiant-approach-to-ot-red-teaming.html\u0022 adhocenable=\u0022false\u0022\u003EOT Red Team\u003C\/a\u003E engagements to illustrate the tactics, techniques, and procedures (TTPs) that can be leveraged by sophisticated threat actors to breach the protected perimeter between an IT network and an OT network. We also examine some of the different types of critical information often found in IT networks that an attacker can leverage during later stages of the Targeted Attack Lifecycle. The goal of this engagement was to access an endpoint meter control infrastructure for a state-wide smart grid environment from the Internet and turn it off. \u0026nbsp;\u0026nbsp;\u003C\/p\u003E\n\u003Cp\u003ETo hear our experts relay more on this and other OT Red Team lessons learned, join our\u0026nbsp;\u003Ca href=\u0022https:\/\/www.brighttalk.com\/webcast\/12695\/480199?utm_source=FireEye\u0026amp;utm_medium=brighttalk\u0026amp;utm_campaign=480199\u0022\u003EFireEye Mandiant Virtual Summit session\u003C\/a\u003E.\u003C\/p\u003E\n\u003Cp\u003EVisit our \u003Ca href=\u0022\/content\/fireeye-www\/en_US\/products\/industrial-systems-and-critical-infrastructure-security.html\u0022 adhocenable=\u0022false\u0022\u003Ewebsite\u003C\/a\u003E to learn more about Mandiant\u2019s OT security practice or contact us directly to request\u0026nbsp;\u003Ca href=\u0022\/content\/fireeye-www\/en_US\/mandiant.html\u0022 adhocenable=\u0022false\u0022\u003EMandiant services\u003C\/a\u003E\u0026nbsp;or\u0026nbsp;\u003Ca href=\u0022\/content\/fireeye-www\/en_US\/mandiant\/threat-intelligence.html\u0022 adhocenable=\u0022false\u0022\u003Ethreat intelligence\u003C\/a\u003E.\u003C\/p\u003E\n\u003Ch4\u003EBuilding the Foundation: Information Gathering for IT-OT Network Propagation\u003C\/h4\u003E\n\u003Cp\u003ETargeted OT attacks attempting to cause physical impacts require planning. A sophisticated actor who is motivated to disrupt or modify an industrial process from a public network will necessarily need to maintain access to the victim environment and remain undetected for enough time to accomplish their objective. Throughout this time, the actor will strive to learn about the control process to formulate the attack, figure out how to pivot to the OT systems and bypass security controls, and sometimes even develop or deploy custom OT malware.\u003C\/p\u003E\n\u003Cp\u003ESimilar to the techniques used by TEMP.Veles to reach the OT network during the \u003Ca href=\u0022\/content\/fireeye-www\/en_US\/blog\/threat-research\/2019\/04\/triton-actor-ttp-profile-custom-attack-tools-detections.html\u0022 adhocenable=\u0022false\u0022\u003ETRITON incident\u003C\/a\u003E, Mandiant\u2019s experience during red team engagements highlights that collecting information from IT network assets plays a crucial role in targeted OT attacks. As a result, the internal reconnaissance phase for OT targeted attacks begins in the enterprise network, where the actor obtains knowledge and resources to propagate from an initial compromise in the IT network to remote access in the OT network. Detailed information collected about the target, their security operations, and their environment can also support an actor\u0027s attempts at remaining undetected while expanding operations.\u003C\/p\u003E\n\u003Cp\u003E\u003Cimg src=\u0022\/content\/dam\/fireeye-www\/blog\/images\/ot-lessons-learned\/fig1.jpg\u0022 alt=\u0022\u0022\u003E\u003Cbr\u003E\n\u003Cspan class=\u0022type-XS\u0022\u003EFigure 1: Targeted OT attack from a public network\u003C\/span\u003E\u003C\/p\u003E\n\u003Ch4\u003EThinking Like an Adversary: How to Turn Off Smart Energy Meters\u003C\/h4\u003E\n\u003Cp\u003EThe ideal scenario for an attacker targeting OT systems is to achieve their objective while remaining undetected. Mandiant\u2019s Red Team works with clients across critical infrastructure industries to simulate attack scenarios in which actors can accomplish this goal by gaining access to OT systems via compromise of external facing IT networks. During these engagements, we emulate real actor behaviors to learn about our target and to determine the best paths for IT\/OT network propagation.\u003C\/p\u003E\n\u003Cp\u003EFor this engagement, we simulated an end-to-end OT-specific attack scenario in which we tested the security controls and response capabilities of an organization to protect smart grid meter control infrastructure from an external attacker. Mandiant leveraged weaknesses in people, process, and technology to gain remote access from the public Internet and to achieve a set of pre-approved objectives in the OT environment.\u003C\/p\u003E\n\u003Cp\u003E\u003Ci\u003EEstablishing a Foothold in the IT Network\u003C\/i\u003E\u003C\/p\u003E\n\u003Cp\u003EMandiant conducted a spear phishing exercise to gain initial access into the client\u2019s enterprise network from the Internet. We defined a combination of two different phishing scenarios that we deployed to test email filtering and egress monitoring controls:\u003C\/p\u003E\n\u003Cul\u003E\n\u003Cli\u003EEmbedded link for a malicious file hosted on a Mandiant owned domain on the Internet\u003C\/li\u003E\n\u003Cli\u003EEmail attachment for a Microsoft Office document with auto - executable macro code\u003C\/li\u003E\n\u003C\/ul\u003E\n\u003Cp\u003EThis exercise allowed our team to achieve code execution on a user workstation in the enterprise environment and to establish an unattributable egress communication path to a Mandiant hosted Cobalt Strike Command and Control (C\u0026amp;C) server on the Internet. After establishing a stable communication path with workstations in the enterprise environment, we utilized the following publicly available offensive security tools (OST) to escalate privileges and to obtain domain administrator level access:\u003C\/p\u003E\n\u003Cul\u003E\n\u003Cli\u003E\u003Ca href=\u0022https:\/\/linux.die.net\/man\/1\/ldapsearch\u0022\u003Eldapsearch\u003C\/a\u003E to enumerate information in the enterprise domain\u003C\/li\u003E\n\u003Cli\u003E\u003Ca href=\u0022https:\/\/github.com\/PowerShellMafia\/PowerSploit\u0022\u003EPowerSploit\u003C\/a\u003E to exploit common security misconfigurations in IT\u003C\/li\u003E\n\u003Cli\u003E\u003Ca href=\u0022https:\/\/github.com\/FortyNorthSecurity\/WMImplant\u0022\u003EWMImplant\u003C\/a\u003E to move laterally from one system to another in the internal network\u003C\/li\u003E\n\u003Cli\u003E\u003Ca href=\u0022https:\/\/github.com\/gentilkiwi\/mimikatz\/wiki\u0022\u003EMimikatz\u003C\/a\u003E to extract credentials for local user and domain administrator accounts\u003C\/li\u003E\n\u003C\/ul\u003E\n\u003Cp\u003EAs domain administrators, we gained unrestricted access to a variety of resources connected to the enterprise domain (e.g. server resources, file shares, IT applications, and administrator consoles for IT systems). During the initial stages of our engagement, our actions were in no way different to other less sophisticated intrusions on industrial organizations, such as \u003Ca href=\u0022https:\/\/www.fireeye.com\/blog\/threat-research\/2020\/07\/financially-motivated-actors-are-expanding-access-into-ot.html\u0022\u003Efinancially-motivated\u003C\/a\u003E compromises.\u003C\/p\u003E\n\u003Cp\u003E\u003Ci\u003EDefining Our Path to the OT Network\u003C\/i\u003E\u003C\/p\u003E\n\u003Cp\u003ESimilar to real world threat actors carrying out targeted OT attacks, Mandiant\u2019s OT Red Team dedicates significant effort for internal reconnaissance in the IT network to develop a logical mapping of the extended network architecture and discover targets of interest (people, processes, or technology). The information we acquire helps us to (a) define paths to propagate from the IT to the OT network and (b) achieve our final objective in the OT network without raising alarms. During OT Red Team engagements across different industries, we follow a real attacker\u2019s cost-benefit analysis to determine which sources or methods are most likely to help us obtain that information.\u003C\/p\u003E\n\u003Cp\u003E\u003Cimg src=\u0022\/content\/dam\/fireeye-www\/blog\/images\/ot-lessons-learned\/fig2.jpg\u0022 alt=\u0022\u0022\u003E\u003Cbr\u003E\n\u003Cspan class=\u0022type-XS\u0022\u003EFigure 2: Information sources and target information from enterprise networks\u003C\/span\u003E\u003C\/p\u003E\n\u003Cp\u003EFor this engagement, we leveraged the domain administrator credentials obtained in the previous phase to gain access to Microsoft System Center Configuration Manager (SCCM) in the IT network. Logged into the SCCM console, we leveraged software deployment features for collection to establish C\u0026amp;C over user workstations belonging to pre-selected departments in the client organization.\u003C\/p\u003E\n\u003Cp\u003EMandiant chose the specific groups based on the names of their departments and the description attributes, which suggested a high likelihood of member users with high privilege access for network infrastructure or application management. This included members of the following groups: network management, firewall administration, control engineering, and smart meter operations.\u003C\/p\u003E\n\u003Cp\u003EAccess to user workstations of target employees in these departments enabled us to:\u003C\/p\u003E\n\u003Cul\u003E\n\u003Cli\u003ECapture keystrokes to obtain remote desktop protocol (RDP) credentials for the OT network by using a Cobalt Strike modified script\u003C\/li\u003E\n\u003Cli\u003ELogin to department file shares and extract OT system design documents\u003C\/li\u003E\n\u003Cli\u003EExtract network design documents and backup files for OT firewall configurations found in the firewall management console\u003C\/li\u003E\n\u003Cli\u003EFind plaintext credentials for OT management systems from operation manuals\u003C\/li\u003E\n\u003C\/ul\u003E\n\u003Cp\u003EInternal reconnaissance in the IT network not only allowed us to obtain remote access credentials for the OT network, but to also gain a deeper understanding of the business processes and technical control system operations in the OT environment by reviewing internal OT-specific operational procedures and security documentation such as asset inventories and configurations.\u003C\/p\u003E\n\u003Cp\u003E\u003Ci\u003EPropagating to the OT Network\u003C\/i\u003E\u003C\/p\u003E\n\u003Cp\u003EDuring the process of propagation from IT to OT networks, an actor will leverage previously compromised systems, credentials, or applications to access systems in higher security zones\u2014such as OT demilitarized zones (DMZ). Based on our observations during multiple red teaming engagements and research, the most likely attack vectors for propagation are:\u003C\/p\u003E\n\u003Cp\u003E\u003Cimg src=\u0022\/content\/dam\/fireeye-www\/blog\/images\/ot-lessons-learned\/table1.jpg\u0022 alt=\u0022\u0022\u003E\u003Cbr\u003E\n\u003Cspan class=\u0022type-XS\u0022\u003ETable 1: Most likely attack vectors for IT\/OT propagation\u003C\/span\u003E\u003C\/p\u003E\n\u003Cp\u003EFor this engagement, we initially analyzed the system architecture to define the best path to follow. Engineers from the target organization were required to use multi-factor-authentication (MFA) to gain remote access to jumpbox servers in the OT network. While not impossible, bypassing this setup would require more time and resources. We instead decided to search for other plausible attack propagation paths.\u003C\/p\u003E\n\u003Cp\u003E\u003Cimg src=\u0022\/content\/dam\/fireeye-www\/blog\/images\/ot-lessons-learned\/fig3.jpg\u0022 alt=\u0022\u0022\u003E\u003Cbr\u003E\n\u003Cspan class=\u0022type-XS\u0022\u003EFigure 3: Formal communication path from enterprise to OT network\u003C\/span\u003E\u003C\/p\u003E\n\u003Cp\u003EReviewing the firewall configuration files, we identified a dedicated communication path for management access to a Microsoft Windows patch management server in a DMZ between the IT network and the OT network. This patch management server was running on a virtual machine in the DMZ network, while the administration console for the underlying hypervisor software itself was hosted in the IT network.\u003C\/p\u003E\n\u003Cp\u003EMandiant logged into the administration console for the hypervisor software using IT network domain administrator credentials. We then leveraged guest machine administration features via direct console access to execute commands on the patch management server in the DMZ network. The compromise of the patch management server in the DMZ allowed us to pivot via SMB connections to Microsoft Windows-based intermediary systems in the OT network.\u003C\/p\u003E\n\u003Cp\u003E\u003Cimg src=\u0022\/content\/dam\/fireeye-www\/blog\/images\/ot-lessons-learned\/fig4.jpg\u0022 alt=\u0022\u0022\u003E\u003Cbr\u003E\n\u003Cspan class=\u0022type-XS\u0022\u003EFigure 4: Remote attack propagation path from IT network to OT network\u003C\/span\u003E\u003C\/p\u003E\n\u003Cp\u003ELastly, we compromised Microsoft Windows server systems in the OT network to complete the objectives of the exercise. Using OT credentials retrieved in the previous phases, we authenticated to the SMB service (using single factor authentication) by pivoting through the patch management server in the DMZ network. This enabled us to execute remote console commands on management servers (such as the domain controller) in the OT network.\u003C\/p\u003E\n\u003Cp\u003EWith access to the domain controller in the core OT network, we extracted credentials for high privilege domain administrator accounts in the OT network using DCSYNC and Mimikatz. Using these accounts, we gained control of management servers, application servers, and operator workstations in the OT network. Mandiant was also able to use compromised credentials to login to the human machine interface (HMI) portal for the meter control infrastructure and issue a disconnect command for a target endpoint meter in the smart grid environment.\u003C\/p\u003E\n\u003Ch4\u003EStrategic Collection and Detection Opportunities During Reconnaissance and Network Propagation\u003C\/h4\u003E\n\u003Cp\u003EAlthough specific capabilities such as malware and tooling vary amongst incidents, internal reconnaissance and network propagation are consistently needed for sophisticated adversaries to expand remote operations from external networks to OT systems. Focusing collection, detection, and hunting efforts on assets or information that are likely to be compromised during these phases presents defenders with strategic opportunities to hunt for and detect targeted adversary activity before it poses a risk to control systems.\u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp; \u0026nbsp;\u003C\/p\u003E\n\u003Cul\u003E\n\u003Cli\u003EIn a previous blog post stating our approach to OT security, we highlighted that IT networks close to production networks and OT intermediary systems remain the best zones to detect OT targeted attacks, a.k.a. \u201c\u003Ca href=\u0022\/content\/fireeye-www\/en_US\/blog\/threat-research\/2019\/12\/fireeye-approach-to-operational-technology-security.html\u0022 adhocenable=\u0022false\u0022\u003EThe Funnel of Opportunity\u003C\/a\u003E\u201d. As actors pivot across systems and networks to gather information and elevate privileges, they leave footprints that can be tracked before they propagate to critical systems.\u003C\/li\u003E\n\u003Cli\u003EAn actor who covertly performs internal reconnaissance and propagates to the OT network is already positioned to cause damage on mission critical assets and is unlikely to be discovered. Early detection of adversary activity before reaching critical OT systems will decrease the dwell time and the risk of an incident.\u003C\/li\u003E\n\u003Cli\u003EOT defenders can prioritize collection and detection, alert triage, and incident response efforts by becoming familiar with the types of information and services that OT focused threat actors commonly search for during internal reconnaissance in IT networks and network propagation across OT intermediary systems.\u003C\/li\u003E\n\u003Cli\u003EUnderstanding where this information resides presents defenders with a catalog of systems and networks to focus collection and detection efforts on. Defenders can create tailored detections to hunt for adversary activity pursuing this information, prioritize alert response efforts, and identify additional security controls to implement. Mandiant red teaming in OT can help organizations identify which data is valuable for attackers to support their network propagation efforts and which systems are most likely to be compromised by attackers targeting OT networks.\u003C\/li\u003E\n\u003C\/ul\u003E\n\u003Cp\u003EVisit our website for\u0026nbsp;\u003Ca href=\u0022\/content\/fireeye-www\/en_US\/products\/industrial-systems-and-critical-infrastructure-security.html\u0022 adhocenable=\u0022false\u0022\u003Emore information\u003C\/a\u003E\u0026nbsp;or to request\u0026nbsp;\u003Ca href=\u0022\/content\/fireeye-www\/en_US\/mandiant.html\u0022 adhocenable=\u0022false\u0022\u003EMandiant services\u003C\/a\u003E\u0026nbsp;or\u0026nbsp;\u003Ca href=\u0022\/content\/fireeye-www\/en_US\/mandiant\/threat-intelligence.html\u0022 adhocenable=\u0022false\u0022\u003Ethreat intelligence\u003C\/a\u003E.\u003C\/p\u003E\n",
        "jcr:lastModified": "Tue Apr 13 2021 15:50:36 GMT+0000",
        "sling:resourceType": "social\/blog\/components\/entrytext"
      }
    },
    "summary": {
      "jcr:primaryType": "nt:unstructured",
      "jcr:lastModifiedBy": "adam.greenberg@fireeye.com",
      "text": "\u003Cp\u003EWe provide a case study to illustrate the TTPs that can be leveraged by threat actors to breach the protected perimeter between an IT network and an OT network.\u003C\/p\u003E\n",
      "jcr:lastModified": "Mon Apr 12 2021 22:17:25 GMT+0000",
      "sling:resourceType": "social\/blog\/components\/entrytextteaser"
    },
    "image": {
      "jcr:primaryType": "nt:unstructured",
      "jcr:lastModifiedBy": "adam.greenberg@fireeye.com",
      "jcr:lastModified": "Mon Apr 12 2021 22:22:18 GMT+0000",
      "imageRotate": "0"
    }
  }
}

{
  "jcr:primaryType": "cq:Page",
  "jcr:createdBy": "admin",
  "jcr:created": "Tue Jan 19 2021 13:59:59 GMT+0000",
  "jcr:content": {
    "jcr:primaryType": "cq:PageContent",
    "jcr:mixinTypes": [
      "mix:versionable"
    ],
    "jcr:createdBy": "admin",
    "jcr:title": "Remediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452",
    "jcr:versionHistory": "718b779d-8fc2-4495-a411-2083c44b3948",
    "author": "Mike Burns",
    "cq:template": "\/apps\/fireeye-blog\/templates\/page_blogpost",
    "jcr:language": "en_us",
    "jcr:predecessors": [
      "7723300b-f26b-462b-9cdb-56dfc210a0ef"
    ],
    "jcr:created": "Thu Mar 18 2021 17:37:05 GMT+0000",
    "cq:lastModified": "Thu Mar 18 2021 17:36:53 GMT+0000",
    "jcr:baseVersion": "7723300b-f26b-462b-9cdb-56dfc210a0ef",
    "jcr:isCheckedOut": true,
    "cq:tags": [
      "fireeye-blog-authors:mike-burns",
      "fireeye-blog-authors:matthew-mcwhirt",
      "fireeye-blog-authors:douglas-bienstock",
      "fireeye-blog-authors:nick-bennett",
      "fireeye-blog-threat-research:threat-research",
      "fireeye-blog-tags:homepage-carousel",
      "fireeye-blog-tags:latest",
      "fireeye-blog-tags:unc",
      "fireeye-blog-tags:TTPs",
      "fireeye-blog-tags:detection"
    ],
    "jcr:uuid": "cae9499c-0374-4b17-abfc-08c99f6f09bf",
    "sling:resourceType": "social\/blog\/components\/page",
    "published": "Tue Jan 19 2021 09:00:00 GMT-0500",
    "cq:lastModifiedBy": "adam.greenberg@fireeye.com",
    "par": {
      "jcr:primaryType": "nt:unstructured",
      "sling:resourceType": "foundation\/components\/parsys",
      "entry": {
        "jcr:primaryType": "nt:unstructured",
        "jcr:lastModifiedBy": "adam.greenberg@fireeye.com",
        "text": "\u003Cp\u003E\u003Ci\u003EUPDATE (Mar. 18):\u0026nbsp;Mandiant recently observed targeted threat actors modifying mailbox folder permissions of user mailboxes to maintain persistent access to the targeted users\u0027 email messages. This stealthy technique is not usually monitored by defenders and provides threat actors a way to access the desired email messages using any compromised credentials. The white paper, blog post and Azure AD Investigator tool have been updated to reflect these findings.\u0026nbsp;Mandiant would like to thank the members of Microsoft\u2019s Detection and Response Team (DART) for their collaboration on this research.\u003C\/i\u003E\u003C\/p\u003E\n\u003Cp\u003EIn December 2020, FireEye uncovered and publicly disclosed a widespread attacker campaign that is being tracked as \u003Ca href=\u0022\/content\/fireeye-www\/en_US\/blog\/threat-research\/2020\/12\/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html\u0022 adhocenable=\u0022false\u0022\u003EUNC2452\u003C\/a\u003E. In some, but not all, of the intrusions associated with this campaign where Mandiant has visibility, the attacker used their access to on-premises networks to gain unauthorized access to the victim\u2019s Microsoft 365 environment.\u003C\/p\u003E\n\u003Ch4\u003EGoals and Objectives\u003C\/h4\u003E\n\u003Cp\u003EMethodologies that UNC2452 and other threat actors have used to move laterally from on-premises networks to the Microsoft 365 cloud have been detailed in our white paper, \u003Ci\u003E\u003Ca adhocenable=\u0022false\u0022 href=\u0022\/content\/dam\/collateral\/en\/wp-m-unc2452.pdf\u0022 target=\u0022_blank\u0022\u003ERemediation and Hardening Strategies for Microsoft 365 to Defend Against UNC2452\u003C\/a\u003E\u003C\/i\u003E. The paper also discusses how organizations can proactively harden their environments and remediate environments where similar techniques have been observed.\u003C\/p\u003E\n\u003Cp\u003EMandiant is releasing an auditing script, \u003Ca href=\u0022https:\/\/github.com\/fireeye\/Mandiant-Azure-AD-Investigator\u0022\u003EAzure AD Investigator\u003C\/a\u003E, through its GitHub repository that organizations can use to check their Microsoft 365 tenants for indicators of some of the techniques used by UNC2452. The script will alert administrators and security practitioners to artifacts that may require further review to determine if they are truly malicious or part of legitimate activity. Many of the attacker techniques detailed in the white paper are dual-use in nature\u2014they can be used by threat actors but also by legitimate tools. Therefore, a detailed review for specific configuration parameters may be warranted, including correlating and verifying that configurations are aligned with authorized and expected activities.\u003C\/p\u003E\n\u003Ch4\u003EAttacker Tactics, Techniques and Procedures (TTPs)\u003C\/h4\u003E\n\u003Cp\u003EMandiant has observed UNC2452 and other threat actors moving laterally to the Microsoft 365 cloud using a combination of four primary techniques:\u003C\/p\u003E\n\u003Col\u003E\n\u003Cli\u003ESteal the Active Directory Federation Services (AD FS) token-signing certificate and use it to forge tokens for arbitrary users (sometimes described as \u003Ca href=\u0022https:\/\/www.cyberark.com\/resources\/threat-research-blog\/golden-saml-newly-discovered-attack-technique-forges-authentication-to-cloud-apps\u0022\u003EGolden SAML\u003C\/a\u003E). This would allow the attacker to authenticate into a federated resource provider (such as Microsoft 365) as any user, without the need for that user\u2019s password or their corresponding multi-factor authentication (MFA) mechanism.\u003C\/li\u003E\n\u003Cli\u003EModify or add trusted domains in Azure AD to add a new federated Identity Provider (IdP) that the attacker controls. This would allow the attacker to forge tokens for arbitrary users and has been described as an \u003Ca href=\u0022https:\/\/o365blog.com\/post\/aadbackdoor\/\u0022\u003EAzure AD\u003C\/a\u003E \u003Ca href=\u0022\/content\/fireeye-www\/en_US\/blog\/threat-research\/2020\/09\/detecting-microsoft-365-azure-active-directory-backdoors.html\u0022 adhocenable=\u0022false\u0022\u003Ebackdoor\u003C\/a\u003E.\u003C\/li\u003E\n\u003Cli\u003ECompromise the credentials of on-premises user accounts that are synchronized to Microsoft 365 that have high privileged directory roles, such as Global Administrator or Application Administrator.\u003C\/li\u003E\n\u003Cli\u003E\u003Ca href=\u0022https:\/\/dirkjanm.io\/azure-ad-privilege-escalation-application-admin\/\u0022\u003EBackdoor\u003C\/a\u003E an existing Microsoft 365 application by adding a new application or service principal credential in order to use the legitimate permissions assigned to the application, such as the ability to read email, send email as an arbitrary user, access user calendars, etc.\u003C\/li\u003E\n\u003Cli\u003EModify the permissions of folders in a victim mailbox (such as the inbox) to make its contents readable by any other user in the victim\u2019s Microsoft 365 environment.\u003C\/li\u003E\n\u003C\/ol\u003E\n\u003Cp\u003ERead the \u003Ca href=\u0022\/content\/dam\/collateral\/en\/wp-m-unc2452.pdf\u0022 target=\u0022_blank\u0022 adhocenable=\u0022false\u0022\u003Ewhite paper\u003C\/a\u003E for a detailed overview of each technique, including practical remediation and hardening strategies, and check out our auditing script, \u003Ca adhocenable=\u0022false\u0022 href=\u0022https:\/\/github.com\/fireeye\/Mandiant-Azure-AD-Investigator\u0022\u003EAzure AD Investigator\u003C\/a\u003E.\u0026nbsp;\u0026nbsp;\u003C\/p\u003E\n\u003Ch4\u003EDetections\u003C\/h4\u003E\n\u003Ctable border=\u00221\u0022 cellspacing=\u00220\u0022 cellpadding=\u00220\u0022 width=\u0022660\u0022\u003E\n\u003Ctbody\u003E\u003Ctr\u003E\u003Ctd width=\u0022264\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Cb\u003EFireEye Helix Detection\u003C\/b\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022209\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Cb\u003EMITRE Technique\u003C\/b\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022186\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Cb\u003EDetection Logic\u003C\/b\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003Ctr\u003E\u003Ctd width=\u0022264\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EMICROSOFT AZURE ACTIVE DIRECTORY [Risky Sign-In]\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022209\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1078\/004\/\u0022\u003ET1078.004\u003C\/a\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022186\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EAlert on suspicious logon activity as detected by Azure Identity Protection\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003Ctr\u003E\u003Ctd width=\u0022264\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EOFFICE 365 [Federated Domain Set]\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022209\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1550\/\u0022\u003ET1550\u003C\/a\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022186\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EAlert on new domain federation in Office 365\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003Ctr\u003E\u003Ctd width=\u0022264\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EOFFICE 365 [Modified Domain Federation Settings]\u003C\/p\u003E\n\u003Cp\u003E\u0026nbsp;\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022209\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1550\/\u0022\u003ET1550\u003C\/a\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022186\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EAlert of modification to domain federations settings in Office 365\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003Ctr\u003E\u003Ctd width=\u0022264\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EOFFICE 365 [User Added Credentials to Service Principal]\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022209\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1098\/001\/\u0022\u003ET1098.011\u003C\/a\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022186\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EAlert on addition of certificates or passwords added to Service Principals\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003Ctr\u003E\u003Ctd width=\u0022264\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EOFFICE 365 ANALYTICS [Abnormal Logon]\u003C\/p\u003E\n\u003Cp\u003E\u0026nbsp;\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022209\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1078\/004\/\u0022\u003ET1078.004\u003C\/a\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022186\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EAlert on suspicious login activity based on heuristics\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003Ctr\u003E\u003Ctd width=\u0022264\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EWINDOWS METHODOLOGY [ADFS Dump]\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022209\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/tactics\/TA0006\/\u0022\u003ETA0006\u003C\/a\u003E\u003C\/p\u003E\n\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1552\/\u0022\u003ET1552\u003C\/a\u003E\u003C\/p\u003E\n\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1552\/004\/\u0022\u003ET1552.004\u003C\/a\u003E\u003C\/p\u003E\n\u003Cp\u003E\u003Ca href=\u0022https:\/\/attack.mitre.org\/techniques\/T1199\/\u0022\u003ET1199\u003C\/a\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd width=\u0022186\u0022 valign=\u0022top\u0022\u003E\u003Cp\u003EAlert on activity access requests for the AD FS Distributed Key Manager (DKM) container in Active Directory\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003Ctr\u003E\u003Ctd\u003E\u003Cp\u003EOFFICE 365 [Mailbox Folder Permission Change \u2013 Inbox and Top Of Information Store]\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd\u003E\u003Cp\u003E\u003Ca adhocenable=\u0022false\u0022 href=\u0022https:\/\/attack.mitre.org\/techniques\/T1098\/002\/\u0022\u003ET1098.002\u003C\/a\u003E\u003C\/p\u003E\n\u003C\/td\u003E\n\u003Ctd\u003E\u003Cp\u003EAlert on suspicious modifications of mailbox folder permissions for the inbox or top of information store.\u003C\/p\u003E\n\u003C\/td\u003E\n\u003C\/tr\u003E\u003C\/tbody\u003E\u003C\/table\u003E\n",
        "jcr:lastModified": "Thu Mar 18 2021 17:36:53 GMT+0000",
        "sling:resourceType": "social\/blog\/components\/entrytext"
      }
    },
    "summary": {
      "jcr:primaryType": "nt:unstructured",
      "jcr:lastModifiedBy": "adam.greenberg@fireeye.com",
      "text": "\u003Cp\u003EWe are releasing a white paper covering four techniques used by UNC2452, as well as an auditing script to check for indicators of some of these technqiues.\u003C\/p\u003E\n",
      "jcr:lastModified": "Wed Jan 13 2021 21:12:25 GMT+0000",
      "sling:resourceType": "social\/blog\/components\/entrytextteaser"
    },
    "image": {
      "jcr:primaryType": "nt:unstructured",
      "jcr:lastModifiedBy": "adam.greenberg@fireeye.com",
      "jcr:lastModified": "Mon Jan 18 2021 23:26:04 GMT+0000",
      "imageRotate": "0"
    }
  }
}
